version: '3.8'

services:
  assignment1_validator:
    image: android-validator:latest
    container_name: episode1_assignment1_validator
    
    # Volume Mounts
    volumes:
      - ./submission:/submission                          # Student XML files (read-only)
      - ./validate_xml.py:/validator/validate_xml.py     # Validation tests
      - ./enhance_json.py:/validator/enhance_json.py     # JSON enhancement
      - ./validator.sh:/validator/validator.sh           # Validator script
    
    # Security Configuration
    cap_drop:
      - ALL                                              # Drop all capabilities
    security_opt:
      - no-new-privileges:true                           # Prevent privilege escalation
    read_only: true                                      # Read-only filesystem
    tmpfs:
      - /tmp                                             # Temp files allowed (writable)
      - /run                                             # Runtime directory
    
    # Resource Limits
    deploy:
      resources:
        limits:
          cpus: '1'
          memory: 256M
        reservations:
          cpus: '0.5'
          memory: 128M
    
    # Execution
    command: /validator/validator.sh init
    restart: unless-stopped
    networks:
      - validator_network

networks:
  validator_network:
    driver: bridge
